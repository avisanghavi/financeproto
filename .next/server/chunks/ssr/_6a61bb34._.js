module.exports=[18956,96818,99602,a=>{"use strict";let b=Symbol.for("constructDateFrom");function c(a,c){return"function"==typeof a?a(c):a&&"object"==typeof a&&b in a?a[b](c):a instanceof Date?new a.constructor(c):new Date(c)}function d(a,b){return c(b||a,a)}a.s(["constructFromSymbol",0,b,"millisecondsInDay",0,864e5],96818),a.s(["constructFrom",()=>c],18956),a.s(["toDate",()=>d],99602)},47820,a=>{"use strict";var b=a.i(18956),c=a.i(99602);function d(a,d,e){let f=(0,c.toDate)(a,e?.in);if(isNaN(d))return(0,b.constructFrom)(e?.in||a,NaN);if(!d)return f;let g=f.getDate(),h=(0,b.constructFrom)(e?.in||a,f.getTime());return(h.setMonth(f.getMonth()+d+1,0),g>=h.getDate())?h:(f.setFullYear(h.getFullYear(),h.getMonth(),g),f)}a.s(["addMonths",()=>d])},47355,a=>{"use strict";var b=a.i(18956);function c(a,...d){let e=b.constructFrom.bind(null,a||d.find(a=>"object"==typeof a));return d.map(e)}a.s(["normalizeDates",()=>c])},48461,a=>{"use strict";var b=a.i(99602);function c(a,c){let d=(0,b.toDate)(a,c?.in);return d.setHours(0,0,0,0),d}a.s(["startOfDay",()=>c])},23075,a=>{"use strict";var b=a.i(47355),c=a.i(99602);function d(a){let b=(0,c.toDate)(a),d=new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds()));return d.setUTCFullYear(b.getFullYear()),a-d}var e=a.i(96818),f=a.i(48461);function g(a,c,g){let[i,j]=(0,b.normalizeDates)(g?.in,a,c),k=h(i,j),l=Math.abs(function(a,c,g){let[h,i]=(0,b.normalizeDates)(void 0,a,c),j=(0,f.startOfDay)(h),k=(0,f.startOfDay)(i);return Math.round((j-d(j)-(k-d(k)))/e.millisecondsInDay)}(i,j));i.setDate(i.getDate()-k*l);let m=Number(h(i,j)===-k),n=k*(l-m);return 0===n?0:n}function h(a,b){let c=a.getFullYear()-b.getFullYear()||a.getMonth()-b.getMonth()||a.getDate()-b.getDate()||a.getHours()-b.getHours()||a.getMinutes()-b.getMinutes()||a.getSeconds()-b.getSeconds()||a.getMilliseconds()-b.getMilliseconds();return c<0?-1:c>0?1:c}a.s(["differenceInDays",()=>g],23075)},10406,a=>{"use strict";var b=a.i(99602);function c(a,c){return+(0,b.toDate)(a)<+(0,b.toDate)(c)}a.s(["isBefore",()=>c])},66448,a=>{"use strict";var b=a.i(99602);function c(a,c){return+(0,b.toDate)(a)>+(0,b.toDate)(c)}a.s(["isAfter",()=>c])},9933,a=>{"use strict";var b=a.i(47355),c=a.i(48461);function d(a,d,e){let[f,g]=(0,b.normalizeDates)(e?.in,a,d);return+(0,c.startOfDay)(f)==+(0,c.startOfDay)(g)}a.s(["isSameDay",()=>d])},19311,a=>a.a(async(b,c)=>{try{var d=a.i(66518),e=a.i(47820),f=a.i(23075),g=a.i(10406),h=a.i(66448),i=a.i(9933),j=a.i(48461),k=b([d]);async function l(a){let b=(await d.prisma.shareCertificate.findMany({where:{companyId:a,status:"OUTSTANDING",shareClass:{type:"COMMON"}},include:{shareClass:!0}})).reduce((a,b)=>a+b.quantity,0),c=(await d.prisma.shareCertificate.findMany({where:{companyId:a,status:"OUTSTANDING",shareClass:{type:"PREFERRED"}},include:{shareClass:!0}})).reduce((a,b)=>{let c=Number(b.shareClass.conversionRatio);return a+Math.floor(b.quantity*c)},0),e=(await d.prisma.optionGrant.findMany({where:{companyId:a,status:{in:["ACTIVE","PARTIALLY_EXERCISED"]}},include:{exercises:!0}})).reduce((a,b)=>{let c=b.exercises.reduce((a,b)=>a+b.sharesExercised,0);return a+(b.originalQuantity-c-b.expiredQuantity)},0),f=(await d.prisma.equityPlan.findMany({where:{companyId:a}})).reduce((a,b)=>a+b.availableShares,0),g=await d.prisma.convertible.findMany({where:{companyId:a,status:"OUTSTANDING"}}),h=await d.prisma.shareClass.findFirst({where:{companyId:a,type:"PREFERRED"},orderBy:{createdAt:"desc"}}),i=0;for(let a of g){let b=Number(a.principal),c="CONVERTIBLE_NOTE"===a.type?r(a):0,d=b+c;if(a.valuationCap){let b=Number(a.valuationCap)/1e7;i+=Math.floor(d/b)}else if(h){let b=a.discount?Number(a.discount):0,c=Number(h.pricePerShare)*(1-b);c>0&&(i+=Math.floor(d/c))}}let j=b+c+e+f+i;return{outstandingCommon:b,outstandingPreferredAsConverted:c,allOutstandingOptions:e,availableOptionPool:f,convertibleShares:i,total:j}}async function m(a){return(await d.prisma.shareCertificate.findMany({where:{companyId:a,status:"OUTSTANDING"}})).reduce((a,b)=>a+b.quantity,0)}async function n(a){let b=await d.prisma.stakeholder.findMany({where:{companyId:a},include:{shareCertificates:{where:{status:"OUTSTANDING"},include:{shareClass:!0}},optionGrants:{where:{status:{in:["ACTIVE","PARTIALLY_EXERCISED"]}},include:{exercises:!0,vestingSchedule:!0}},convertibles:{where:{status:"OUTSTANDING"}}}}),c=await l(a),e=await m(a);return b.map(a=>{let b=a.shareCertificates.reduce((a,b)=>{let c="PREFERRED"===b.shareClass.type?Number(b.shareClass.conversionRatio):1;return a+Math.floor(b.quantity*c)},0),d=a.optionGrants.reduce((a,b)=>{let c=b.exercises.reduce((a,b)=>a+b.sharesExercised,0);return a+(b.originalQuantity-c-b.expiredQuantity)},0),f=0;for(let b of a.convertibles){let a=Number(b.principal),d="CONVERTIBLE_NOTE"===b.type?r(b):0,e=a+d;if(b.valuationCap){let a=Number(b.valuationCap)/c.total||1;f+=Math.floor(e/a)}}let g=b+d+f,h=a.shareCertificates.reduce((a,b)=>a+Number(b.cashPaid),0)+a.convertibles.reduce((a,b)=>a+Number(b.principal),0);return{stakeholderId:a.id,stakeholderName:a.name,stakeholderType:a.type,outstandingShares:b,fullyDilutedShares:g,outstandingPercent:e>0?b/e:0,fullyDilutedPercent:c.total>0?g/c.total:0,totalInvested:h}})}async function o(a){let b=await d.prisma.shareClass.findMany({where:{companyId:a},include:{shareCertificates:{where:{status:"OUTSTANDING"}}}}),c=await l(a),e=await m(a);return b.map(a=>{let b=a.shareCertificates.reduce((a,b)=>a+b.quantity,0),d="PREFERRED"===a.type?Number(a.conversionRatio):1,f=Math.floor(b*d);return{shareClassId:a.id,shareClassName:a.name,shareClassType:a.type,outstandingShares:b,fullyDilutedShares:f,outstandingPercent:e>0?b/e:0,fullyDilutedPercent:c.total>0?f/c.total:0}})}function p(a,b,c){let d=[],f=(0,j.startOfDay)(new Date(b.vestingStartDate)),k=Number(b.cliffPercentage),l=(0,e.addMonths)(f,b.cliffMonths),m=Math.floor(a*k),n=a-m,o=b.totalPeriods-b.cliffMonths,p=o>0?Math.floor(n/o):0;if(c&&(0,g.isBefore)((0,j.startOfDay)(c),l)&&!(0,i.isSameDay)((0,j.startOfDay)(c),l))return[];d.push({periodNumber:0,vestingDate:l,sharesVested:m,cumulativeVested:m});let q=m,r="MONTHLY"===b.periodUnit?1:"QUARTERLY"===b.periodUnit?3:12;for(let a=1;a<=o;a++){let b=(0,e.addMonths)(l,a*r);if(c&&(0,h.isAfter)(b,(0,j.startOfDay)(c)))break;let f=a===o?n-p*(o-1):p;q+=f,d.push({periodNumber:a,vestingDate:b,sharesVested:f,cumulativeVested:q})}return d}function q(a){let b=Math.round(100*Number(a.cliffPercentage)),c=a.cliffMonths/12,d=a.totalPeriods/12,e=a.periodUnit.toLowerCase();return"MONTHLY"===a.periodUnit?`1/${a.totalPeriods} ${e} vesting with a ${c} year cliff (${b}%)`:`${d}-year ${e} vesting with a ${c}-year cliff`}function r(a,b=new Date){if("CONVERTIBLE_NOTE"!==a.type||!a.interestRate||!a.interestStartDate)return 0;let c=Number(a.principal),d=Number(a.interestRate),e=new Date(a.interestStartDate),g=(0,f.differenceInDays)(b,e);return g<=0?0:c*d*(g/365)}function s(a,b=new Date){let c=Number(a.principal),d=r(a,b);return c+d}async function t(a){let[b,c,e,f]=await Promise.all([l(a),d.prisma.equityPlan.findMany({where:{companyId:a}}),d.prisma.shareCertificate.findMany({where:{companyId:a,status:"OUTSTANDING"}}),d.prisma.convertible.findMany({where:{companyId:a,status:"OUTSTANDING"}})]),g=c.reduce((a,b)=>a+b.availableShares,0),h=e.reduce((a,b)=>a+Number(b.cashPaid),0)+f.reduce((a,b)=>a+Number(b.principal),0);return{fullyDilutedShares:b.total,fullyDilutedBreakdown:b,availableShares:g,amountRaised:h}}[d]=k.then?(await k)():k,a.s(["calculateAccruedInterest",()=>r,"generateVestingPeriods",()=>p,"getCapTableMetrics",()=>t,"getOwnershipByShareClass",()=>o,"getOwnershipByStakeholder",()=>n,"getTotalConvertibleAmount",()=>s,"getVestingDescription",()=>q]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_6a61bb34._.js.map