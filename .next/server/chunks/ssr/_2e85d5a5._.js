module.exports=[24686,a=>a.a(async(b,c)=>{try{var d=a.i(66518),e=b([d]);async function f(a,b){let c=0;switch(a){case"CS":{let a=await d.prisma.shareCertificate.findFirst({where:{companyId:b},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("CS-",""),10);isNaN(b)||(c=b)}break}case"ES":{let a=await d.prisma.optionGrant.findFirst({where:{companyId:b},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("ES-",""),10);isNaN(b)||(c=b)}break}case"SAFE":{let a=await d.prisma.convertible.findFirst({where:{companyId:b,type:"SAFE"},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("SAFE-",""),10);isNaN(b)||(c=b)}break}case"CN":{let a=await d.prisma.convertible.findFirst({where:{companyId:b,type:"CONVERTIBLE_NOTE"},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("CN-",""),10);isNaN(b)||(c=b)}}}let e=c+1;return`${a}-${e.toString().padStart(2,"0")}`}[d]=e.then?(await e)():e,a.s(["generateSecurityId",()=>f]),c()}catch(a){c(a)}},!1),29145,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(66518),f=a.i(24686),g=a.i(18558);a.i(70396);var h=a.i(73727),i=a.i(53112),j=a.i(13095),k=b([e,f]);[e,f]=k.then?(await k)():k;let n=i.z.object({stakeholderId:i.z.string().min(1,"Stakeholder is required"),type:i.z.enum(["SAFE","CONVERTIBLE_NOTE"]),principal:i.z.coerce.number().positive("Principal must be positive"),interestRate:i.z.coerce.number().min(0).max(1).optional().nullable(),interestStartDate:i.z.string().optional().nullable(),valuationCap:i.z.coerce.number().positive().optional().nullable(),valuationCapType:i.z.enum(["PRE_MONEY","POST_MONEY"]).optional().nullable(),discount:i.z.coerce.number().min(0).max(1).optional().nullable(),convertsToClassId:i.z.string().optional().nullable(),liquidityPriority:i.z.coerce.number().int().positive().optional().nullable(),cashoutMultiplier:i.z.coerce.number().positive().optional().nullable(),issueDate:i.z.string().min(1,"Issue date is required"),boardApprovalDate:i.z.string().optional().nullable(),conversionPriceBasis:i.z.array(i.z.string()).optional().default([]),status:i.z.enum(["OUTSTANDING","CONVERTED","CANCELLED","REPAID"]).default("OUTSTANDING")});async function l(a,b){let c=await e.prisma.company.findFirst();if(!c)return{errors:{_form:["No company found"]}};let d=b.get("type"),i=b.getAll("conversionPriceBasis"),j=n.safeParse({stakeholderId:b.get("stakeholderId"),type:d,principal:b.get("principal"),interestRate:"CONVERTIBLE_NOTE"===d&&parseFloat(b.get("interestRate"))/100||null,interestStartDate:"CONVERTIBLE_NOTE"===d?b.get("interestStartDate"):null,valuationCap:b.get("valuationCap")||null,valuationCapType:b.get("valuationCapType")||null,discount:b.get("discount")?parseFloat(b.get("discount"))/100:null,convertsToClassId:b.get("convertsToClassId")||null,liquidityPriority:b.get("liquidityPriority")||null,cashoutMultiplier:b.get("cashoutMultiplier")||null,issueDate:b.get("issueDate"),boardApprovalDate:b.get("boardApprovalDate")||null,conversionPriceBasis:i,status:b.get("status")||"OUTSTANDING"});if(!j.success)return{errors:j.error.flatten().fieldErrors};let k=j.data;try{let a="SAFE"===k.type?"SAFE":"CN",b=await (0,f.generateSecurityId)(a,c.id),d=await e.prisma.convertible.create({data:{companyId:c.id,securityId:b,stakeholderId:k.stakeholderId,type:k.type,principal:k.principal,interestRate:k.interestRate,interestStartDate:k.interestStartDate?new Date(k.interestStartDate):null,valuationCap:k.valuationCap,valuationCapType:k.valuationCapType,discount:k.discount,convertsToClassId:k.convertsToClassId,liquidityPriority:k.liquidityPriority,cashoutMultiplier:k.cashoutMultiplier,issueDate:new Date(k.issueDate),boardApprovalDate:k.boardApprovalDate?new Date(k.boardApprovalDate):null,conversionPriceBasis:k.conversionPriceBasis,status:k.status}});await e.prisma.auditLog.create({data:{companyId:c.id,action:"CREATE",entityType:"Convertible",entityId:d.id,after:d}}),(0,g.revalidatePath)("/convertibles"),(0,g.revalidatePath)("/cap-table"),(0,g.revalidatePath)("/")}catch(a){return console.error("Error creating convertible:",a),{errors:{_form:["Failed to create convertible"]}}}(0,h.redirect)("/convertibles")}async function m(a,b,c){let d=await e.prisma.convertible.findUnique({where:{id:a}});if(!d)return{errors:{_form:["Convertible not found"]}};let f=c.get("type"),i=c.getAll("conversionPriceBasis"),j=n.safeParse({stakeholderId:c.get("stakeholderId"),type:f,principal:c.get("principal"),interestRate:"CONVERTIBLE_NOTE"===f&&parseFloat(c.get("interestRate"))/100||null,interestStartDate:"CONVERTIBLE_NOTE"===f?c.get("interestStartDate"):null,valuationCap:c.get("valuationCap")||null,valuationCapType:c.get("valuationCapType")||null,discount:c.get("discount")?parseFloat(c.get("discount"))/100:null,convertsToClassId:c.get("convertsToClassId")||null,liquidityPriority:c.get("liquidityPriority")||null,cashoutMultiplier:c.get("cashoutMultiplier")||null,issueDate:c.get("issueDate"),boardApprovalDate:c.get("boardApprovalDate")||null,conversionPriceBasis:i,status:c.get("status")||"OUTSTANDING"});if(!j.success)return{errors:j.error.flatten().fieldErrors};let k=j.data;try{let b=await e.prisma.convertible.update({where:{id:a},data:{stakeholderId:k.stakeholderId,type:k.type,principal:k.principal,interestRate:k.interestRate,interestStartDate:k.interestStartDate?new Date(k.interestStartDate):null,valuationCap:k.valuationCap,valuationCapType:k.valuationCapType,discount:k.discount,convertsToClassId:k.convertsToClassId,liquidityPriority:k.liquidityPriority,cashoutMultiplier:k.cashoutMultiplier,issueDate:new Date(k.issueDate),boardApprovalDate:k.boardApprovalDate?new Date(k.boardApprovalDate):null,conversionPriceBasis:k.conversionPriceBasis,status:k.status}});await e.prisma.auditLog.create({data:{companyId:d.companyId,action:"UPDATE",entityType:"Convertible",entityId:b.id,before:d,after:b}}),(0,g.revalidatePath)("/convertibles"),(0,g.revalidatePath)(`/convertibles/${a}`),(0,g.revalidatePath)("/cap-table"),(0,g.revalidatePath)("/")}catch(a){return console.error("Error updating convertible:",a),{errors:{_form:["Failed to update convertible"]}}}(0,h.redirect)(`/convertibles/${a}`)}(0,j.ensureServerEntryExports)([l,m]),(0,d.registerServerReference)(l,"60421a5fce6afd1b5d5a69344381f4971bb692c5f6",null),(0,d.registerServerReference)(m,"70fdc3fd8cbed3b0c39a338fa259549966cbbb3b45",null),a.s(["createConvertible",()=>l,"updateConvertible",()=>m]),c()}catch(a){c(a)}},!1),45035,a=>a.a(async(b,c)=>{try{var d=a.i(29145),e=b([d]);[d]=e.then?(await e)():e,a.s([]),c()}catch(a){c(a)}},!1),15778,a=>a.a(async(b,c)=>{try{var d=a.i(45035),e=a.i(29145),f=b([d,e]);[d,e]=f.then?(await f)():f,a.s(["60421a5fce6afd1b5d5a69344381f4971bb692c5f6",()=>e.createConvertible,"70fdc3fd8cbed3b0c39a338fa259549966cbbb3b45",()=>e.updateConvertible]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_2e85d5a5._.js.map