{"version":3,"sources":["../../../../src/components/admin-sidebar.tsx/__nextjs-internal-proxy.mjs","../../../../src/lib/admin-auth.ts","../../../../src/app/%28admin%29/layout.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const AdminSidebar = registerClientReference(\n    function() { throw new Error(\"Attempted to call AdminSidebar() from the server but AdminSidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/admin-sidebar.tsx\",\n    \"AdminSidebar\",\n);\n","import { prisma } from \"./prisma\";\nimport { cookies } from \"next/headers\";\nimport { redirect } from \"next/navigation\";\nimport crypto from \"crypto\";\n\nconst SESSION_COOKIE_NAME = \"admin_session\";\nconst SESSION_EXPIRY_DAYS = 7;\n\n// Simple password hashing (for production, use bcrypt)\nfunction hashPassword(password: string): string {\n  return crypto.createHash(\"sha256\").update(password).digest(\"hex\");\n}\n\nexport function verifyPassword(password: string, hash: string): boolean {\n  return hashPassword(password) === hash;\n}\n\nexport async function createSession(userId: string): Promise<string> {\n  const token = crypto.randomBytes(32).toString(\"hex\");\n  const expiresAt = new Date();\n  expiresAt.setDate(expiresAt.getDate() + SESSION_EXPIRY_DAYS);\n\n  await prisma.adminSession.create({\n    data: {\n      userId,\n      token,\n      expiresAt,\n    },\n  });\n\n  return token;\n}\n\nexport async function getAdminUser() {\n  const cookieStore = await cookies();\n  const sessionToken = cookieStore.get(SESSION_COOKIE_NAME)?.value;\n\n  if (!sessionToken) {\n    return null;\n  }\n\n  const session = await prisma.adminSession.findUnique({\n    where: { token: sessionToken },\n    include: { user: true },\n  });\n\n  if (!session || session.expiresAt < new Date()) {\n    // Session expired or not found\n    if (session) {\n      await prisma.adminSession.delete({ where: { id: session.id } });\n    }\n    return null;\n  }\n\n  return session.user;\n}\n\nexport async function requireAdmin() {\n  const user = await getAdminUser();\n  if (!user) {\n    redirect(\"/auth/login\");\n  }\n  return user;\n}\n\nexport async function login(email: string, password: string): Promise<{ success: boolean; error?: string; token?: string }> {\n  const user = await prisma.adminUser.findUnique({\n    where: { email: email.toLowerCase() },\n  });\n\n  if (!user) {\n    return { success: false, error: \"Invalid email or password\" };\n  }\n\n  if (!verifyPassword(password, user.passwordHash)) {\n    return { success: false, error: \"Invalid email or password\" };\n  }\n\n  const token = await createSession(user.id);\n  return { success: true, token };\n}\n\nexport async function logout() {\n  const cookieStore = await cookies();\n  const sessionToken = cookieStore.get(SESSION_COOKIE_NAME)?.value;\n\n  if (sessionToken) {\n    await prisma.adminSession.deleteMany({\n      where: { token: sessionToken },\n    });\n  }\n}\n\n// Helper to create the initial admin user\nexport async function createAdminUser(email: string, password: string, name?: string) {\n  const passwordHash = hashPassword(password);\n  \n  return prisma.adminUser.upsert({\n    where: { email: email.toLowerCase() },\n    update: { passwordHash, name },\n    create: {\n      email: email.toLowerCase(),\n      passwordHash,\n      name,\n      role: \"ADMIN\",\n    },\n  });\n}\n","import { AdminSidebar } from \"@/components/admin-sidebar\";\nimport { requireAdmin } from \"@/lib/admin-auth\";\n\nexport default async function AdminLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const user = await requireAdmin();\n\n  return (\n    <div className=\"flex h-screen\">\n      <AdminSidebar userEmail={user.email} userName={user.name} />\n      <main className=\"flex-1 overflow-auto bg-gray-50\">\n        <div className=\"p-8\">{children}</div>\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":"kIAEO,IAAM,EAAe,CAAA,EAAA,AAD5B,EAAA,CAAA,CAAA,OAC4B,uBAAA,AAAuB,EAC/C,WAAa,MAAM,AAAI,MAAM,sOAAwO,EACrQ,iEACA,mEAHG,IAAM,EAAe,CAAA,EAD5B,AAC4B,EAD5B,CAAA,CAAA,OAC4B,uBAAuB,AAAvB,EACxB,WAAa,MAAM,AAAI,MAAM,sOAAwO,EACrQ,6CACA,yGCLJ,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,oBA8BO,eAAe,IACpB,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,OAAO,AAAP,IACpB,EAAe,EAAY,GAAG,CAAC,AA9BX,kBA8BiC,MAE3D,GAAI,CAAC,EACH,OAAO,KADU,AAInB,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,CACnD,MAAO,CAAE,MAAO,CAAa,EAC7B,QAAS,CAAE,KAAM,EAAK,CACxB,SAEA,AAAI,CAAC,GAAW,EAAQ,SAAS,CAAG,IAAI,MAElC,EAF0C,CAG5C,MADW,AACL,EAAA,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAE,MAAO,CAAE,GAAI,EAAQ,EAAE,AAAC,CAAE,GAExD,MAGF,EAAQ,IAAI,AACrB,CAEO,eAAe,IACpB,IAAM,EAAO,MAAM,IAInB,OAHI,AAAC,GACH,CAAA,EADS,AACT,EAAA,QAAA,AAAQ,EAAC,eAEJ,CACT,4HC/DA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,gBAEe,eAAe,EAAY,UACxC,CAAQ,CAGT,EACC,IAAM,EAAO,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAE/B,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,CAAC,UAAW,EAAK,KAAK,CAAE,SAAU,EAAK,IAAI,GACxD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,2CACd,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,eAAO,QAI9B","ignoreList":[0]}