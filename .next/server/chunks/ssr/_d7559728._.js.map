{"version":3,"sources":["../../../../src/lib/vesting.ts","../../../../src/lib/security-id.ts","../../../../src/app/%28admin%29/options/actions.ts","../../../../.next-internal/server/app/%28admin%29/options/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { prisma } from \"./prisma\";\nimport { generateVestingPeriods, type VestingPeriodData } from \"./calculations\";\nimport type { OptionGrant, VestingSchedule, VestingPeriod } from \"@prisma/client\";\n\n/**\n * Creates VestingPeriod records in the database for an option grant.\n * Should be called when creating or updating a grant's vesting schedule.\n */\nexport async function createVestingPeriodRecords(\n  vestingScheduleId: string,\n  originalQuantity: number,\n  schedule: {\n    vestingStartDate: Date;\n    cliffMonths: number;\n    cliffPercentage: number;\n    totalPeriods: number;\n    periodUnit: \"MONTHLY\" | \"QUARTERLY\" | \"ANNUALLY\";\n  },\n  terminationDate?: Date | null\n): Promise<VestingPeriod[]> {\n  // Delete existing periods\n  await prisma.vestingPeriod.deleteMany({\n    where: { vestingScheduleId },\n  });\n\n  // Generate new periods\n  const periods = generateVestingPeriods(\n    originalQuantity,\n    schedule,\n    terminationDate\n  );\n\n  // Create records\n  const created = await prisma.vestingPeriod.createManyAndReturn({\n    data: periods.map((p) => ({\n      vestingScheduleId,\n      periodNumber: p.periodNumber,\n      vestingDate: p.vestingDate,\n      sharesVested: p.sharesVested,\n      cumulativeVested: p.cumulativeVested,\n    })),\n  });\n\n  return created;\n}\n\n/**\n * Updates vesting periods when a grant is terminated.\n * Removes all periods after the termination date.\n */\nexport async function updateVestingForTermination(\n  optionGrantId: string,\n  terminationDate: Date\n): Promise<void> {\n  const grant = await prisma.optionGrant.findUnique({\n    where: { id: optionGrantId },\n    include: { vestingSchedule: true },\n  });\n\n  if (!grant || !grant.vestingSchedule) return;\n\n  // Regenerate periods with termination date\n  await createVestingPeriodRecords(\n    grant.vestingSchedule.id,\n    grant.originalQuantity,\n    {\n      vestingStartDate: grant.vestingSchedule.vestingStartDate,\n      cliffMonths: grant.vestingSchedule.cliffMonths,\n      cliffPercentage: Number(grant.vestingSchedule.cliffPercentage),\n      totalPeriods: grant.vestingSchedule.totalPeriods,\n      periodUnit: grant.vestingSchedule.periodUnit,\n    },\n    terminationDate\n  );\n}\n\n/**\n * Gets the vesting progress for an option grant.\n */\nexport async function getVestingProgress(\n  grantId: string,\n  asOfDate: Date = new Date()\n): Promise<{\n  totalShares: number;\n  vestedShares: number;\n  unvestedShares: number;\n  exercisedShares: number;\n  exercisableShares: number;\n  vestedPercent: number;\n  exercisedPercent: number;\n}> {\n  const grant = await prisma.optionGrant.findUnique({\n    where: { id: grantId },\n    include: {\n      vestingSchedule: {\n        include: { vestingPeriods: { orderBy: { periodNumber: \"asc\" } } },\n      },\n      exercises: {\n        where: { status: { in: [\"APPROVED\", \"COMPLETED\"] } },\n      },\n    },\n  });\n\n  if (!grant) {\n    return {\n      totalShares: 0,\n      vestedShares: 0,\n      unvestedShares: 0,\n      exercisedShares: 0,\n      exercisableShares: 0,\n      vestedPercent: 0,\n      exercisedPercent: 0,\n    };\n  }\n\n  const totalShares = grant.originalQuantity - grant.expiredQuantity;\n  const exercisedShares = grant.exercises.reduce(\n    (sum, ex) => sum + ex.sharesExercised,\n    0\n  );\n\n  // Calculate vested shares from periods\n  let vestedShares = 0;\n  if (grant.vestingSchedule) {\n    for (const period of grant.vestingSchedule.vestingPeriods) {\n      if (new Date(period.vestingDate) <= asOfDate) {\n        vestedShares = period.cumulativeVested;\n      }\n    }\n  }\n\n  const unvestedShares = totalShares - vestedShares;\n  const exercisableShares = Math.max(0, vestedShares - exercisedShares);\n\n  return {\n    totalShares,\n    vestedShares,\n    unvestedShares,\n    exercisedShares,\n    exercisableShares,\n    vestedPercent: totalShares > 0 ? vestedShares / totalShares : 0,\n    exercisedPercent: totalShares > 0 ? exercisedShares / totalShares : 0,\n  };\n}\n\n/**\n * Gets all vesting periods with their current status.\n */\nexport async function getVestingPeriodsWithStatus(\n  grantId: string,\n  asOfDate: Date = new Date()\n): Promise<\n  Array<{\n    periodNumber: number;\n    vestingDate: Date;\n    sharesVested: number;\n    cumulativeVested: number;\n    isVested: boolean;\n    isPast: boolean;\n  }>\n> {\n  const grant = await prisma.optionGrant.findUnique({\n    where: { id: grantId },\n    include: {\n      vestingSchedule: {\n        include: { vestingPeriods: { orderBy: { periodNumber: \"asc\" } } },\n      },\n    },\n  });\n\n  if (!grant?.vestingSchedule) return [];\n\n  return grant.vestingSchedule.vestingPeriods.map((period) => {\n    const vestingDate = new Date(period.vestingDate);\n    const isVested = vestingDate <= asOfDate;\n    const isPast = vestingDate < asOfDate;\n\n    return {\n      periodNumber: period.periodNumber,\n      vestingDate,\n      sharesVested: period.sharesVested,\n      cumulativeVested: period.cumulativeVested,\n      isVested,\n      isPast,\n    };\n  });\n}\n","import { prisma } from \"./prisma\";\n\nexport type SecurityIdPrefix = \"CS\" | \"ES\" | \"SAFE\" | \"CN\";\n\n/**\n * Generates a unique security ID with the given prefix.\n * Format: PREFIX-XX (e.g., CS-01, ES-12, SAFE-03, CN-01)\n */\nexport async function generateSecurityId(\n  prefix: SecurityIdPrefix,\n  companyId: string\n): Promise<string> {\n  let maxNumber = 0;\n\n  switch (prefix) {\n    case \"CS\": {\n      const lastCert = await prisma.shareCertificate.findFirst({\n        where: { companyId },\n        orderBy: { securityId: \"desc\" },\n        select: { securityId: true },\n      });\n      if (lastCert) {\n        const num = parseInt(lastCert.securityId.replace(\"CS-\", \"\"), 10);\n        if (!isNaN(num)) maxNumber = num;\n      }\n      break;\n    }\n    case \"ES\": {\n      const lastGrant = await prisma.optionGrant.findFirst({\n        where: { companyId },\n        orderBy: { securityId: \"desc\" },\n        select: { securityId: true },\n      });\n      if (lastGrant) {\n        const num = parseInt(lastGrant.securityId.replace(\"ES-\", \"\"), 10);\n        if (!isNaN(num)) maxNumber = num;\n      }\n      break;\n    }\n    case \"SAFE\": {\n      const lastSafe = await prisma.convertible.findFirst({\n        where: { companyId, type: \"SAFE\" },\n        orderBy: { securityId: \"desc\" },\n        select: { securityId: true },\n      });\n      if (lastSafe) {\n        const num = parseInt(lastSafe.securityId.replace(\"SAFE-\", \"\"), 10);\n        if (!isNaN(num)) maxNumber = num;\n      }\n      break;\n    }\n    case \"CN\": {\n      const lastCN = await prisma.convertible.findFirst({\n        where: { companyId, type: \"CONVERTIBLE_NOTE\" },\n        orderBy: { securityId: \"desc\" },\n        select: { securityId: true },\n      });\n      if (lastCN) {\n        const num = parseInt(lastCN.securityId.replace(\"CN-\", \"\"), 10);\n        if (!isNaN(num)) maxNumber = num;\n      }\n      break;\n    }\n  }\n\n  const nextNumber = maxNumber + 1;\n  return `${prefix}-${nextNumber.toString().padStart(2, \"0\")}`;\n}\n\n/**\n * Parses a security ID and returns the prefix and number.\n */\nexport function parseSecurityId(securityId: string): {\n  prefix: SecurityIdPrefix;\n  number: number;\n} | null {\n  const match = securityId.match(/^(CS|ES|SAFE|CN)-(\\d+)$/);\n  if (!match) return null;\n  return {\n    prefix: match[1] as SecurityIdPrefix,\n    number: parseInt(match[2], 10),\n  };\n}\n","\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { generateSecurityId } from \"@/lib/security-id\";\nimport { createVestingPeriodRecords } from \"@/lib/vesting\";\nimport { revalidatePath } from \"next/cache\";\nimport { redirect } from \"next/navigation\";\nimport { z } from \"zod\";\n\nconst optionGrantSchema = z.object({\n  stakeholderId: z.string().min(1, \"Stakeholder is required\"),\n  equityPlanId: z.string().min(1, \"Equity plan is required\"),\n  originalQuantity: z.coerce.number().int().positive(\"Quantity must be positive\"),\n  exercisePrice: z.coerce.number().positive(\"Exercise price must be positive\"),\n  type: z.enum([\"ISO\", \"NSO\"]),\n  grantDate: z.string().min(1, \"Grant date is required\"),\n  boardApprovalDate: z.string().optional(),\n  expirationDate: z.string().min(1, \"Expiration date is required\"),\n  grantReason: z.string().optional(),\n  status: z.enum([\"ACTIVE\", \"PARTIALLY_EXERCISED\", \"FULLY_EXERCISED\", \"EXPIRED\", \"CANCELLED\", \"TERMINATED\"]).default(\"ACTIVE\"),\n  // Vesting schedule\n  vestingStartDate: z.string().min(1, \"Vesting start date is required\"),\n  cliffMonths: z.coerce.number().int().min(0).default(12),\n  cliffPercentage: z.coerce.number().min(0).max(1).default(0.25),\n  totalPeriods: z.coerce.number().int().positive().default(48),\n  periodUnit: z.enum([\"MONTHLY\", \"QUARTERLY\", \"ANNUALLY\"]).default(\"MONTHLY\"),\n  scheduleName: z.string().optional(),\n});\n\nexport type OptionGrantFormState = {\n  errors?: {\n    stakeholderId?: string[];\n    equityPlanId?: string[];\n    originalQuantity?: string[];\n    exercisePrice?: string[];\n    type?: string[];\n    grantDate?: string[];\n    expirationDate?: string[];\n    vestingStartDate?: string[];\n    cliffMonths?: string[];\n    totalPeriods?: string[];\n    _form?: string[];\n  };\n  message?: string;\n};\n\nexport async function createOptionGrant(\n  prevState: OptionGrantFormState,\n  formData: FormData\n): Promise<OptionGrantFormState> {\n  const company = await prisma.company.findFirst();\n  if (!company) {\n    return { errors: { _form: [\"No company found\"] } };\n  }\n\n  const validatedFields = optionGrantSchema.safeParse({\n    stakeholderId: formData.get(\"stakeholderId\"),\n    equityPlanId: formData.get(\"equityPlanId\"),\n    originalQuantity: formData.get(\"originalQuantity\"),\n    exercisePrice: formData.get(\"exercisePrice\"),\n    type: formData.get(\"type\"),\n    grantDate: formData.get(\"grantDate\"),\n    boardApprovalDate: formData.get(\"boardApprovalDate\"),\n    expirationDate: formData.get(\"expirationDate\"),\n    grantReason: formData.get(\"grantReason\"),\n    status: formData.get(\"status\") || \"ACTIVE\",\n    vestingStartDate: formData.get(\"vestingStartDate\"),\n    cliffMonths: formData.get(\"cliffMonths\"),\n    cliffPercentage: parseFloat(formData.get(\"cliffPercentage\") as string) || 0.25,\n    totalPeriods: formData.get(\"totalPeriods\"),\n    periodUnit: formData.get(\"periodUnit\"),\n    scheduleName: formData.get(\"scheduleName\"),\n  });\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n    };\n  }\n\n  const data = validatedFields.data;\n\n  // Check equity plan has enough shares\n  const equityPlan = await prisma.equityPlan.findUnique({\n    where: { id: data.equityPlanId },\n  });\n\n  if (!equityPlan) {\n    return { errors: { _form: [\"Equity plan not found\"] } };\n  }\n\n  if (equityPlan.availableShares < data.originalQuantity) {\n    return {\n      errors: {\n        originalQuantity: [\n          `Not enough shares in pool. Available: ${equityPlan.availableShares.toLocaleString()}`,\n        ],\n      },\n    };\n  }\n\n  try {\n    // Generate security ID\n    const securityId = await generateSecurityId(\"ES\", company.id);\n\n    // Create grant with vesting schedule in a transaction\n    const grant = await prisma.$transaction(async (tx) => {\n      // Create the grant\n      const newGrant = await tx.optionGrant.create({\n        data: {\n          companyId: company.id,\n          securityId,\n          stakeholderId: data.stakeholderId,\n          equityPlanId: data.equityPlanId,\n          originalQuantity: data.originalQuantity,\n          exercisePrice: data.exercisePrice,\n          type: data.type,\n          grantDate: new Date(data.grantDate),\n          boardApprovalDate: data.boardApprovalDate\n            ? new Date(data.boardApprovalDate)\n            : null,\n          expirationDate: new Date(data.expirationDate),\n          grantReason: data.grantReason || null,\n          status: data.status,\n        },\n      });\n\n      // Create vesting schedule\n      const vestingSchedule = await tx.vestingSchedule.create({\n        data: {\n          optionGrantId: newGrant.id,\n          scheduleName: data.scheduleName || null,\n          vestingStartDate: new Date(data.vestingStartDate),\n          cliffMonths: data.cliffMonths,\n          cliffPercentage: data.cliffPercentage,\n          totalPeriods: data.totalPeriods,\n          periodUnit: data.periodUnit,\n        },\n      });\n\n      // Decrement available shares in equity plan\n      await tx.equityPlan.update({\n        where: { id: data.equityPlanId },\n        data: { availableShares: { decrement: data.originalQuantity } },\n      });\n\n      // Create default post-termination exercise periods\n      await tx.postTerminationExercisePeriod.createMany({\n        data: [\n          { optionGrantId: newGrant.id, terminationType: \"VOLUNTARY\", duration: 90, durationUnit: \"DAYS\" },\n          { optionGrantId: newGrant.id, terminationType: \"INVOLUNTARY\", duration: 90, durationUnit: \"DAYS\" },\n          { optionGrantId: newGrant.id, terminationType: \"FOR_CAUSE\", duration: 0, durationUnit: \"DAYS\" },\n          { optionGrantId: newGrant.id, terminationType: \"DEATH\", duration: 12, durationUnit: \"MONTHS\" },\n          { optionGrantId: newGrant.id, terminationType: \"DISABILITY\", duration: 12, durationUnit: \"MONTHS\" },\n          { optionGrantId: newGrant.id, terminationType: \"RETIREMENT\", duration: 3, durationUnit: \"MONTHS\" },\n        ],\n      });\n\n      return { grant: newGrant, vestingSchedule };\n    });\n\n    // Create vesting periods outside transaction (uses Prisma client)\n    await createVestingPeriodRecords(\n      grant.vestingSchedule.id,\n      data.originalQuantity,\n      {\n        vestingStartDate: new Date(data.vestingStartDate),\n        cliffMonths: data.cliffMonths,\n        cliffPercentage: data.cliffPercentage,\n        totalPeriods: data.totalPeriods,\n        periodUnit: data.periodUnit,\n      }\n    );\n\n    // Create audit log\n    await prisma.auditLog.create({\n      data: {\n        companyId: company.id,\n        action: \"CREATE\",\n        entityType: \"OptionGrant\",\n        entityId: grant.grant.id,\n        after: grant.grant as any,\n      },\n    });\n\n    revalidatePath(\"/options\");\n    revalidatePath(\"/cap-table\");\n    revalidatePath(\"/\");\n  } catch (error) {\n    console.error(\"Error creating option grant:\", error);\n    return { errors: { _form: [\"Failed to create option grant\"] } };\n  }\n\n  redirect(\"/options\");\n}\n\nexport async function exerciseOptions(\n  grantId: string,\n  formData: FormData\n): Promise<{ error?: string }> {\n  const grant = await prisma.optionGrant.findUnique({\n    where: { id: grantId },\n    include: {\n      vestingSchedule: {\n        include: { vestingPeriods: true },\n      },\n      exercises: {\n        where: { status: { in: [\"APPROVED\", \"COMPLETED\"] } },\n      },\n      stakeholder: true,\n      equityPlan: true,\n    },\n  });\n\n  if (!grant) {\n    return { error: \"Grant not found\" };\n  }\n\n  const sharesToExercise = parseInt(formData.get(\"sharesToExercise\") as string, 10);\n  const paymentMethod = formData.get(\"paymentMethod\") as string;\n  const fmvAtExercise = parseFloat(formData.get(\"fmvAtExercise\") as string);\n\n  if (!sharesToExercise || sharesToExercise <= 0) {\n    return { error: \"Invalid number of shares\" };\n  }\n\n  // Calculate vested and exercisable\n  const now = new Date();\n  let vestedShares = 0;\n  if (grant.vestingSchedule) {\n    for (const period of grant.vestingSchedule.vestingPeriods) {\n      if (new Date(period.vestingDate) <= now) {\n        vestedShares = period.cumulativeVested;\n      }\n    }\n  }\n\n  const exercised = grant.exercises.reduce((sum, ex) => sum + ex.sharesExercised, 0);\n  const exercisable = vestedShares - exercised;\n\n  if (sharesToExercise > exercisable) {\n    return { error: `Cannot exercise more than ${exercisable.toLocaleString()} shares` };\n  }\n\n  try {\n    // Get common share class for the certificate\n    const commonClass = await prisma.shareClass.findFirst({\n      where: { companyId: grant.companyId, type: \"COMMON\" },\n    });\n\n    if (!commonClass) {\n      return { error: \"No common share class found\" };\n    }\n\n    // Generate certificate security ID\n    const certSecurityId = await generateSecurityId(\"CS\", grant.companyId);\n\n    const totalCost = sharesToExercise * Number(grant.exercisePrice);\n\n    // Create certificate and exercise in transaction\n    await prisma.$transaction(async (tx) => {\n      // Create the share certificate\n      const certificate = await tx.shareCertificate.create({\n        data: {\n          companyId: grant.companyId,\n          securityId: certSecurityId,\n          stakeholderId: grant.stakeholderId,\n          shareClassId: commonClass.id,\n          quantity: sharesToExercise,\n          pricePerShare: grant.exercisePrice,\n          cashPaid: totalCost,\n          costBasis: totalCost,\n          acquisitionDate: now,\n          issueDate: now,\n          status: \"OUTSTANDING\",\n        },\n      });\n\n      // Create the exercise record\n      await tx.optionExercise.create({\n        data: {\n          optionGrantId: grantId,\n          shareCertificateId: certificate.id,\n          sharesExercised: sharesToExercise,\n          exercisePrice: grant.exercisePrice,\n          totalCost,\n          exerciseDate: now,\n          fmvAtExercise,\n          paymentMethod: paymentMethod as any,\n          status: \"COMPLETED\",\n          approvedAt: now,\n        },\n      });\n\n      // Update grant status if fully exercised\n      const newTotalExercised = exercised + sharesToExercise;\n      const newStatus =\n        newTotalExercised >= grant.originalQuantity - grant.expiredQuantity\n          ? \"FULLY_EXERCISED\"\n          : \"PARTIALLY_EXERCISED\";\n\n      await tx.optionGrant.update({\n        where: { id: grantId },\n        data: { status: newStatus },\n      });\n    });\n\n    // Create audit log\n    await prisma.auditLog.create({\n      data: {\n        companyId: grant.companyId,\n        action: \"EXERCISE\",\n        entityType: \"OptionGrant\",\n        entityId: grantId,\n        after: { sharesToExercise, paymentMethod, fmvAtExercise },\n      },\n    });\n\n    revalidatePath(\"/options\");\n    revalidatePath(`/options/${grantId}`);\n    revalidatePath(\"/certificates\");\n    revalidatePath(\"/cap-table\");\n    revalidatePath(\"/\");\n  } catch (error) {\n    console.error(\"Error exercising options:\", error);\n    return { error: \"Failed to exercise options\" };\n  }\n\n  redirect(`/options/${grantId}`);\n}\n","export {createOptionGrant as '60044db7427d22521822256a6d3a656c9b2b5799f0'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}