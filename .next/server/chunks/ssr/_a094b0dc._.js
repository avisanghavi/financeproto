module.exports=[24686,a=>a.a(async(b,c)=>{try{var d=a.i(66518),e=b([d]);async function f(a,b){let c=0;switch(a){case"CS":{let a=await d.prisma.shareCertificate.findFirst({where:{companyId:b},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("CS-",""),10);isNaN(b)||(c=b)}break}case"ES":{let a=await d.prisma.optionGrant.findFirst({where:{companyId:b},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("ES-",""),10);isNaN(b)||(c=b)}break}case"SAFE":{let a=await d.prisma.convertible.findFirst({where:{companyId:b,type:"SAFE"},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("SAFE-",""),10);isNaN(b)||(c=b)}break}case"CN":{let a=await d.prisma.convertible.findFirst({where:{companyId:b,type:"CONVERTIBLE_NOTE"},orderBy:{securityId:"desc"},select:{securityId:!0}});if(a){let b=parseInt(a.securityId.replace("CN-",""),10);isNaN(b)||(c=b)}}}let e=c+1;return`${a}-${e.toString().padStart(2,"0")}`}[d]=e.then?(await e)():e,a.s(["generateSecurityId",()=>f]),c()}catch(a){c(a)}},!1),48632,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(66518),f=a.i(24686),g=a.i(18558);a.i(70396);var h=a.i(73727),i=a.i(53112),j=a.i(13095),k=b([e,f]);[e,f]=k.then?(await k)():k;let o=i.z.object({stakeholderId:i.z.string().min(1,"Stakeholder is required"),shareClassId:i.z.string().min(1,"Share class is required"),quantity:i.z.coerce.number().int().positive("Quantity must be positive"),pricePerShare:i.z.coerce.number().positive("Price must be positive"),cashPaid:i.z.coerce.number().min(0,"Cash paid cannot be negative"),costBasis:i.z.coerce.number().min(0).optional(),acquisitionDate:i.z.string().min(1,"Acquisition date is required"),issueDate:i.z.string().optional(),originalIssueDate:i.z.string().optional(),status:i.z.enum(["OUTSTANDING","CANCELLED","TRANSFERRED","REPURCHASED"]).default("OUTSTANDING")});async function l(a,b){let c=await e.prisma.company.findFirst();if(!c)return{errors:{_form:["No company found"]}};let d=o.safeParse({stakeholderId:b.get("stakeholderId"),shareClassId:b.get("shareClassId"),quantity:b.get("quantity"),pricePerShare:b.get("pricePerShare"),cashPaid:b.get("cashPaid"),costBasis:b.get("costBasis")||b.get("cashPaid"),acquisitionDate:b.get("acquisitionDate"),issueDate:b.get("issueDate"),originalIssueDate:b.get("originalIssueDate"),status:b.get("status")||"OUTSTANDING"});if(!d.success)return{errors:d.error.flatten().fieldErrors};let i=d.data;try{let a=await (0,f.generateSecurityId)("CS",c.id),b=await e.prisma.shareCertificate.create({data:{companyId:c.id,securityId:a,stakeholderId:i.stakeholderId,shareClassId:i.shareClassId,quantity:i.quantity,pricePerShare:i.pricePerShare,cashPaid:i.cashPaid,costBasis:i.costBasis??i.cashPaid,acquisitionDate:new Date(i.acquisitionDate),issueDate:i.issueDate?new Date(i.issueDate):new Date,originalIssueDate:i.originalIssueDate?new Date(i.originalIssueDate):null,status:i.status}});await e.prisma.auditLog.create({data:{companyId:c.id,action:"CREATE",entityType:"ShareCertificate",entityId:b.id,after:b}}),(0,g.revalidatePath)("/certificates"),(0,g.revalidatePath)("/cap-table"),(0,g.revalidatePath)("/")}catch(a){return console.error("Error creating certificate:",a),{errors:{_form:["Failed to create certificate"]}}}(0,h.redirect)("/certificates")}async function m(a,b,c){let d=await e.prisma.shareCertificate.findUnique({where:{id:a}});if(!d)return{errors:{_form:["Certificate not found"]}};let f=o.safeParse({stakeholderId:c.get("stakeholderId"),shareClassId:c.get("shareClassId"),quantity:c.get("quantity"),pricePerShare:c.get("pricePerShare"),cashPaid:c.get("cashPaid"),costBasis:c.get("costBasis")||c.get("cashPaid"),acquisitionDate:c.get("acquisitionDate"),issueDate:c.get("issueDate"),originalIssueDate:c.get("originalIssueDate"),status:c.get("status")||"OUTSTANDING"});if(!f.success)return{errors:f.error.flatten().fieldErrors};let i=f.data;try{let b=await e.prisma.shareCertificate.update({where:{id:a},data:{stakeholderId:i.stakeholderId,shareClassId:i.shareClassId,quantity:i.quantity,pricePerShare:i.pricePerShare,cashPaid:i.cashPaid,costBasis:i.costBasis??i.cashPaid,acquisitionDate:new Date(i.acquisitionDate),issueDate:i.issueDate?new Date(i.issueDate):void 0,originalIssueDate:i.originalIssueDate?new Date(i.originalIssueDate):null,status:i.status}});await e.prisma.auditLog.create({data:{companyId:d.companyId,action:"UPDATE",entityType:"ShareCertificate",entityId:b.id,before:d,after:b}}),(0,g.revalidatePath)("/certificates"),(0,g.revalidatePath)(`/certificates/${a}`),(0,g.revalidatePath)("/cap-table"),(0,g.revalidatePath)("/")}catch(a){return console.error("Error updating certificate:",a),{errors:{_form:["Failed to update certificate"]}}}(0,h.redirect)(`/certificates/${a}`)}async function n(a){let b=await e.prisma.shareCertificate.findUnique({where:{id:a}});if(!b)throw Error("Certificate not found");await e.prisma.shareCertificate.update({where:{id:a},data:{status:"CANCELLED"}}),await e.prisma.auditLog.create({data:{companyId:b.companyId,action:"DELETE",entityType:"ShareCertificate",entityId:a,before:b}}),(0,g.revalidatePath)("/certificates"),(0,g.revalidatePath)("/cap-table"),(0,g.revalidatePath)("/")}(0,j.ensureServerEntryExports)([l,m,n]),(0,d.registerServerReference)(l,"6093ad5c5e46858a83c3fc7f610335cdcc40c3e712",null),(0,d.registerServerReference)(m,"70431018d6fb193461e63524788a3220b5da11ca4b",null),(0,d.registerServerReference)(n,"40e9cb95acb9f0750e9f38f054fab94890b2bc9034",null),a.s(["createCertificate",()=>l,"updateCertificate",()=>m]),c()}catch(a){c(a)}},!1),4595,a=>a.a(async(b,c)=>{try{var d=a.i(48632),e=b([d]);[d]=e.then?(await e)():e,a.s([]),c()}catch(a){c(a)}},!1),4952,a=>a.a(async(b,c)=>{try{var d=a.i(4595),e=a.i(48632),f=b([d,e]);[d,e]=f.then?(await f)():f,a.s(["6093ad5c5e46858a83c3fc7f610335cdcc40c3e712",()=>e.createCertificate,"70431018d6fb193461e63524788a3220b5da11ca4b",()=>e.updateCertificate]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_a094b0dc._.js.map